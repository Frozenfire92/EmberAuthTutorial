<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Ember Authorization Tutorial by Frozenfire92</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Ember Authorization Tutorial</h1>
        <h2>A quick Ember.js Authorization tutorial using Ember-CLI, Ember-Simple-Auth, and Torii</h2>

        <section id="downloads">
          <a href="https://github.com/Frozenfire92/EmberAuthTutorial/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Frozenfire92/EmberAuthTutorial/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Frozenfire92/EmberAuthTutorial" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="ember-auth-tutorial" class="anchor" href="#ember-auth-tutorial" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ember-auth-tutorial</h1>

<p>This is a tutorial outlining how to create an <a href="http://emberjs.com">Ember.js</a> app with authorization using</p>

<ul>
<li><a href="http://www.ember-cli.com/">Ember-CLI</a></li>
<li><a href="https://github.com/simplabs/ember-simple-auth">Ember-Simple-Auth</a></li>
<li><a href="https://github.com/Vestorly/torii">Torii</a></li>
</ul>

<h1>
<a id="tutorial" class="anchor" href="#tutorial" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tutorial</h1>

<p>This assumes you have git, node, bower, and ember-cli installed</p>

<h3>
<a id="create-a-new-ember-app" class="anchor" href="#create-a-new-ember-app" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a new ember app</h3>

<p><code>ember init</code> or <code>ember new</code> see the ember-cli docs for more info</p>

<h3>
<a id="get-dependencies" class="anchor" href="#get-dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get dependencies</h3>

<pre><code>npm install --save-dev torii ember-cli-simple-auth-torii
ember generate ember-cli-simple-auth-torii
</code></pre>

<h3>
<a id="basic-app-setup" class="anchor" href="#basic-app-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic App setup</h3>

<pre><code>ember g route application
ember g route protected
ember g route login
ember g controller login
</code></pre>

<h3>
<a id="add-mixins" class="anchor" href="#add-mixins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add Mixins</h3>

<pre><code>//--- /app/routes/application.js
import Ember from 'ember';
import ApplicationRouteMixin from 'simple-auth/mixins/application-route-mixin';

export default Ember.Route.extend(ApplicationRouteMixin);
</code></pre>

<pre><code>//--- /app/routes/protected.js
import Ember from 'ember';
import AuthenticatedRouteMixin from 'simple-auth/mixins/authenticated-route-mixin';

export default Ember.Route.extend(AuthenticatedRouteMixin);
</code></pre>

<h3>
<a id="add-login-actions-and-setup-controller" class="anchor" href="#add-login-actions-and-setup-controller" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add Login Actions and setup controller</h3>

<p>You could add more torii providers, see the <a href="https://github.com/Vestorly/torii">documentation</a> for more info</p>

<pre><code>//--- /app/controllers/login.js
import Ember from 'ember';
import LoginControllerMixin from 'simple-auth/mixins/login-controller-mixin';

export default Ember.Controller.extend(LoginControllerMixin, {
  authenticator: 'authenticator:torii'
});
</code></pre>

<pre><code>//--- /app/routes/login.js
import Ember from 'ember';

export default Ember.Route.extend({
    actions: {
        googleLogin: function() {
            this.get('session').authenticate('simple-auth-authenticator:torii', 'google-oauth2');
            return;
        }
    }
});
</code></pre>

<h3>
<a id="update-your-templates" class="anchor" href="#update-your-templates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Update your templates</h3>

<p>See <a href="app/templates">example</a></p>

<h3>
<a id="get-google-setup" class="anchor" href="#get-google-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get google setup</h3>

<p>This is likely analgous to other torii providers, I have only used google</p>

<ul>
<li>client_id from <a href="https://console.developers.google.com/project">google</a> under API &amp; auth &gt; credentials</li>
<li>update your authorized origins (ex. http://localhost:4200/)</li>
<li>update the redirect URI (ex. http://localhost:4200)</li>
</ul>

<h3>
<a id="update-environmentjs" class="anchor" href="#update-environmentjs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Update environment.js</h3>

<pre><code>//--- config/environment.js
ENV['torii'] = {
  providers: {
    'google-oauth2': {
      apiKey: 'client_id from google',
      scope: 'profile',
      redirectUri: 'http://localhost:4200'
    }
  }
};
</code></pre>

<h3>
<a id="test--enjoy" class="anchor" href="#test--enjoy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test &amp; Enjoy</h3>

<p>run <code>ember server</code> and try it out!</p>

<h3>
<a id="bonus-get-user-info-from-google" class="anchor" href="#bonus-get-user-info-from-google" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bonus: Get user info from google</h3>

<p>We are going to create a custom torii provider that will also get the users information from google.
We need the custom provider because the default google-ouath2 uses the code workflow rather than the
token workflow that the google plus api's need. This code extends <a href="https://github.com/Vestorly/torii/blob/master/lib/torii/providers/oauth2-bearer.js">torii oauth2-bearer</a> and borrows from <a href="https://github.com/Vestorly/torii/blob/master/lib/torii/providers/google-oauth2.js">torri google-oauth2</a>. It also uses jQuery for the GET request, if there is a better way let me know!</p>

<ul>
<li><a href="app/torii-providers/google-token.js">Custom Provider</a></li>
</ul>

<p>Then update:</p>

<ul>
<li>
<a href="config/environment.js">environment.js</a> torii provider to match the custom providers name (this provider also uses scope <code>profile email</code>)</li>
<li>Your <a href="app/routes/login.js">login action</a> to match the custom providers name</li>
</ul>

<p>Then enable the Google+ API in your <a href="https://console.developers.google.com/project">google dev console</a></p>

<p>You now will have access to <code>session.content.userName</code> and <code>session.content.userEmail</code></p>
      </section>
    </div>

    
  </body>
</html>